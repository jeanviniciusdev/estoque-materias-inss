{% extends 'stock/base.html' %}
{% block content %}

<div class="container mt-4">
  <div class="card shadow-sm" style="border-radius: 12px; overflow: hidden;">
    <!-- CabeÃ§alho -->
    <div class="card-body bg-warning text-dark d-flex justify-content-between align-items-center">
      <h4 class="fw-bold mb-0">ðŸ“‹ EmprÃ©stimos em andamento</h4>
      <div class="btn-group">
        <a href="{% url 'export_emprestimos' %}?format=csv" class="btn btn-sm btn-outline-dark">CSV</a>
        <a href="{% url 'export_emprestimos' %}?format=xlsx" class="btn btn-sm btn-outline-dark">Excel</a>
      </div>
    </div>

    <!-- Tabela -->
    <div class="card-body">
      <table class="table table-hover table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Material</th>
            <th>UsuÃ¡rio</th>
            <th>Quantidade</th>
            <th>Data de devoluÃ§Ã£o</th>
            <th>Status</th>
            <th>AÃ§Ãµes</th>
          </tr>
        </thead>
        <tbody>
          {% now "Y-m-d" as hoje %}
          {% for e in emprestimos %}
          <tr>
            <!-- Nome do material -->
            <td>{{ e.material.nome }}</td>

            <!-- UsuÃ¡rio -->
            <td>{{ e.usuario.username }}</td>

            <!-- Quantidade -->
            <td>{{ e.quantidade }}</td>

            <!-- Data de devoluÃ§Ã£o -->
            <td>
              {% if e.data_devolucao %}
                {% if e.data_devolucao|stringformat:'s' < hoje %}
                  <strong style="color:#FF3333;">{{ e.data_devolucao|date:"d/m/Y" }}</strong>
                {% else %}
                  {{ e.data_devolucao|date:"d/m/Y" }}
                {% endif %}
              {% else %}
                â€”
              {% endif %}
            </td>

          <!-- Status -->
          <td style="color: {{ e.status_color }};">{{ e.status_label }}</td>

            <!-- AÃ§Ãµes -->
            <td>
              <div class="d-flex justify-content-center gap-2">
                <!-- BotÃ£o para marcar como concluÃ­do -->
                <form method="post" action="{% url 'concluir_emprestimo' e.id %}" style="display:inline;">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-success btn-sm" title="Marcar como concluÃ­do">âœ“</button>
                </form>

                <!-- BotÃ£o para deletar -->
                <form method="post" action="{% url 'deletar_emprestimo' e.id %}" style="display:inline;">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger btn-sm" title="Excluir">âœ•</button>
                </form>
              </div>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-muted text-center">Nenhum emprÃ©stimo em andamento.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% endblock %}
